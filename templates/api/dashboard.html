{% block bar %}
    {% include "base.html" %}
{% endblock %}
{% load static %}

<style>.btn-group {
    padding: 0 10px 0 10px;
}

#popularitySpecialisation {
    overflow: hidden !important;
    padding-top: 15px !important;
}

#nodonutmsg {
    border-color: #ec8282;
    background: #fefefe;
    color: #666666;
    font-weight: bold;
    font-size: small;
    padding: 12px;
    padding-left: 16px;
    border-top: solid 3px #ec8282;
    border-radius: 5px;
    margin-bottom: 10px;
    -webkit-box-shadow: 0 10px 10px -5px rgba(0, 0, 0, .08);
    -moz-box-shadow: 0 10px 10px -5px rgba(0, 0, 0, .08);
    box-shadow: 0 10px 10px -5px rgba(0, 0, 0, .08);
}

.info-box-icon {
    text-align: center !important;
}

@media screen and (max-width: 699px) and (min-width: 768px) {
    #popDivBox{float:none!important;}
}



</style>

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Dashboard</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">

    <!-- Font Awesome -->
    <link rel="stylesheet"
          href="{% static 'AdminLTE-2.4.0-rc/bower_components/font-awesome/css/font-awesome.min.css' %}">
    <!-- Ionicons -->
    <link rel="stylesheet" href="{% static 'AdminLTE-2.4.0-rc/bower_components/Ionicons/css/ionicons.min.css' %}">
    <!-- jvectormap -->
    <link rel="stylesheet" href="{% static 'AdminLTE-2.4.0-rc/bower_components/jvectormap/jquery-jvectormap.css' %}">
    <!-- Theme style -->
    <link rel="stylesheet" href="{% static 'AdminLTE-2.4.0-rc/dist/css/AdminLTE.min.css' %}">
    <!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="{% static 'AdminLTE-2.4.0-rc/dist/css/skins/_all-skins.min.css' %}">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

    <!-- Google Font -->
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
    <link rel="stylesheet" type="text/css" href="{% static 'css/btnfilter-css.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'css/boxesanalytics.css' %}"/>
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">
    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper" style="margin-left:0px!important;">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                Dashboard
                <small></small>
            </h1>
            <ol class="breadcrumb">
                <li><a href="#"><i class="ion ion-home"></i> Home</a></li>
                <li class="active">Dashboard</li>
            </ol>
        </section>

        <!-- Main content -->
        <section class="content">
            <!-- Info boxes -->
            <div class="row">
                <div class="col-md-12" style="display: flex; margin:25px 0 30px 0px;">
                    <div class="btn-group">
                        <button class="btn btn-default field-btn" type="button" id="schoolField">School</button>
                        <button data-toggle="dropdown" class="btn btn-default dropdown-toggle" type="button"><span
                                class="caret"></span>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a href="#">Infocomm Technology</a></li>
                            <li><a href="#">Business & Accountancy</a></li>
                            <li><a href="#">Design & Environment</a></li>
                            <li><a href="#">Engineering</a></li>
                            <li><a href="#">Film & Media Studies</a></li>
                            <li><a href="#">Health Sciences</a></li>
                            <li><a href="#">Humanities & Social Sciences</a></li>
                            <li><a href="#">Interdisciplinary Studies</a></li>
                            <li><a href="#">Life Sciences & Chemical Technology</a></li>
                        </ul>
                    </div>

                    <div class="btn-group btn-group-primary">
                        <button class="btn btn-primary field-btn" type="button" id="diplomaField">Diploma</button>
                        <button data-toggle="dropdown" class="btn btn-primary dropdown-toggle" type="button"><span
                                class="caret"></span>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a href="#">Information Technology</a></li>
                            <li><a href="#">Financial Informatics</a></li>
                            <li><a href="#">Animation & 3D Arts</a></li>
                            <li><a href="#">Information Security & Forensics</a></li>
                            <li><a href="#">Multimedia & Animation</a></li>
                        </ul>
                        </ul>
                    </div>

                    <div class="btn-group btn-group-success">
                        <button class="btn btn-success field-btn" type="button" id="yearField">Year</button>
                        <button data-toggle="dropdown" class="btn btn-success dropdown-toggle" type="button"><span
                                class="caret" style="display:inline-block"></span>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a href="javascript:void(0)">1</a></li>
                            <li><a href="javascript:void(0)">2</a></li>
                            <li><a href="javascript:void(0)">3</a></li>
                        </ul>
                    </div>

                    <button class="btn btn-info col-md-1" type="button" id="filterBtn">Apply Filter</button>
                    <span style="padding-left:10px;">
         <button class="btn btn-danger clearBtn" type="button">Clear all filters</button>
     </span>

                </div>

                <!-- fix for small devices only -->
                <div class="clearfix visible-sm-block"></div>

            </div>
            <!-- /.row -->

            <!-- Main row -->
            <div class="col-md-6">
                {#        population box  #}
                <div class="col-md-6 col-sm-6" style="padding-left:0px!important;" id="popDivBox">
                    <div class="info-box">
                        <span class="info-box-icon bg-aqua"><i class="ion ion-person-stalker"></i></span>

                        <div class="info-box-content">
                            <span class="info-box-text" id="diplomaName">All Schools</span>
                            <span class="info-box-number" id="diplomaNum">{{ population }}</span>Students
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                    <!-- /.info-box -->
                </div>
                <div class="col-md-6 col-sm-6" style="padding-left:0px!important;">
                    <div class="info-box">
                        <span class="info-box-icon bg-green"><i class="ion ion-android-create"></i></span>

                        <div class="info-box-content">
                            <span class="info-box-text">No. of Course Planning</span>
                            <span class="info-box-number">{{ cpclick }}</span>Students
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                    <!-- /.info-box -->
                </div>
                <br />
                <!-- /pop box -->

                <div class="col-md-12 nav-tabs-custom">
                    <ul class="nav nav-tabs pull-right">
                        <li class="active"><a href="#allInterest" data-toggle="tab">All</a></li>
                        <li><a href="#mostPop" data-toggle="tab">Most Popular</a></li>
                        <li><a href="#leastPop" data-toggle="tab">Least Popular</a></li>
                        <li class="pull-left header"><i class="fa fa-inbox"></i> Specialisation Popularity</li>
                    </ul>
                    <div class="tab-content no-padding">
                        <!-- Career interest popular content -->
                        <div class="chart tab-pane active" id="revenue-chart" style="position: relative;">
                            <div class="col-md-8">
                                <div id="popularitySpecialisation">
                                    {% for sp in allSpecialisation %}
                                        <div class="progress-group">
                                            <span class="progress-text">{{ sp.course_specialization__course_specialization }}</span>
                                            <span class="progress-number"><b>{{ sp.user_count }}</b></span>
                                        </div><br/>
                                    {% endfor %}
                                </div>
                            </div>
                        </div><!-- End of popular content -->
                        <!-- ./box-body -->
                        <div class="box-footer">
                            <div class="row">
                                <div class="col-sm-6 col-xs-6">
                                    <div class="description-block border-right">
                                        {#                    <span class="description-percentage text-green"><i class="fa fa-caret-up"></i> 17%</span>#}
                                        <h5 class="description-header">{{ ratioFYPIntern }}</h5>
                                        <span class="description-text">Ratio between Internship or FYP</span>
                                    </div>
                                    <!-- /.description-block -->
                                </div>
                                <!-- /.col -->
                                <div class="col-sm-6 col-xs-6">
                                    <div class="description-block border-right">
                                        {#                    <span class="description-percentage text-yellow"><i class="fa fa-caret-left"></i> 0%</span>#}
                                        <h5 class="description-header">{{ ratioCourseworkElec }}</h5>
                                        <span class="description-text">Ratio between Coursework or 2 electives</span>
                                    </div>
                                    <!-- /.description-block -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row col-md-6">
                <!-- Left col -->
                <div class="col-md-12 nav-tabs-custom">
                    <!-- Tabs within a box -->
                    <ul class="nav nav-tabs pull-right">
                        <li class="active"><a href="#allInterestCareer" data-toggle="tab">All</a></li>
                        <li><a href="#mostPopCareer" data-toggle="tab">Most Popular</a></li>
                        <li><a href="#leastPopCareer" data-toggle="tab">Least Popular</a></li>
                        <li class="pull-left header"><i class="fa fa-inbox"></i> Career Interest</li>
                    </ul>
                    <div class="tab-content no-padding">
                        <!-- Career interest popular content -->
                        <div class="chart tab-pane active" id="revenue-chart" style="position: relative;">
                            <div class="col-md-12">
                                <div id="popularityCareer" style="padding-top:30px;">
                                    <div class="progress-group">
                                        <span class="progress-text"><u>Interest</u></span>
                                        <span class="progress-number"><strong><u>Count</u></strong></span>
                                    </div>
                                    <br/>
                                    <div class="progress-group">
                                        {% for interestname,count in allInterestCount.items %}
                                            <div class="progress-group"><br/>
                                                <span class="progress-text">{{ interestname }}</span>
                                                <span class="progress-number"><b>{{ count }}</b></span>
                                            </div><br/>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div><!-- End of popular content -->

                        {#            <div style="width:50%!important;height:50%!important">#}
                        {#              <canvas id="pieChart"></canvas>#}
                        {#            </div>#}
                        <hr>
                        <div class="box-body chart-responsive">
                            <div style="float:right">
                                <div class="btn-group btn-group-primary" style="display:inline-block;">
                                    <button class="btn btn-primary field-btn" type="button" id="donut-diplomaField">
                                        Diploma
                                    </button>
                                    <button data-toggle="dropdown" class="btn btn-primary dropdown-toggle"
                                            type="button"><span
                                            class="caret"></span></button>
                                    <ul class="dropdown-menu">
                                        <li><a href="javascript:void(0)">Information Technology</a></li>
                                        <li><a href="javascript:void(0)">Financial Informatics</a></li>
                                        <li><a href="javascript:void(0)">Animation & 3D Arts</a></li>
                                        <li><a href="javascript:void(0)">Information Security & Forensics</a></li>
                                        <li><a href="javascript:void(0)">Multimedia & Animation</a></li>
                                    </ul>
                                </div>
                                <button class="btn btn-info" type="button" id="career-filterBtn">Apply Filter</button>
                            </div>
                            <div class="row col-md-3"><h5><strong>Diploma align with Career Interest</strong></h5></div>
                            <div id="nodonutmsg" style="float:right;display:none"></div>
                            <div class="chart" id="donut-chart" style="width:50%!important;height:50%!important"></div>
                        </div>
                        <!-- /.box-body -->

                        <!-- /.box -->
                    </div>
                </div>
            </div>
            <!-- /.nav-tabs-custom -->

        <div class="col-md-7">
            <div class="box">
                <div class="box-header with-border">
                    <h3 class="box-title">Specialisations</h3>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse"><i
                                class="fa fa-minus"></i>
                        </button>
                        <div class="btn-group">
                            <button type="button" class="btn btn-box-tool dropdown-toggle"
                                    data-toggle="dropdown">
                                <i class="fa fa-wrench"></i></button>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href="#">Action</a></li>
                                <li><a href="#">Another action</a></li>
                                <li><a href="#">Something else here</a></li>
                                <li class="divider"></li>
                                <li><a href="#">Separated link</a></li>
                            </ul>
                        </div>
                        <button type="button" class="btn btn-box-tool" data-widget="remove"><i
                                class="fa fa-times"></i></button>
                    </div>
                </div>

                <div class="row col-md-12" style="padding-top:10px;">
                    <div class="btn-group btn-group-primary">
                        <button class="btn btn-primary field-btn" type="button" id="sp-diplomaField">Diploma
                        </button>
                        <button data-toggle="dropdown" class="btn btn-primary dropdown-toggle"
                                type="button"><span
                                class="caret"></span></button>
                        <ul class="dropdown-menu" id="spdiploma-dropdown-menu">
                            <li><a href="javascript:void(0)">Information Technology</a></li>
                            <li><a href="javascript:void(0)">Financial Informatics</a></li>
                            <li><a href="javascript:void(0)">Animation & 3D Arts</a></li>
                            <li><a href="javascript:void(0)">Information Security & Forensics</a></li>
                            <li><a href="javascript:void(0)">Multimedia & Animation</a></li>
                        </ul>
                    </div>

                    <div class="btn-group btn-group-success">
                        <button class="btn btn-success field-btn" type="button" id="sp-yearField">Year</button>
                        <button data-toggle="dropdown" class="btn btn-success dropdown-toggle"
                                type="button"><span
                                class="caret"></span></button>
                        <ul class="dropdown-menu" id="sp-dropdown-menu">
                            <li><a href="javascript:void(0)" class="small" data-value="1" tabIndex="-1"><input
                                    type="checkbox"/> Year 1</a></li>
                            <li><a href="javascript:void(0)" class="small" data-value="2" tabIndex="-1"><input
                                    type="checkbox"/> Year 2</a></li>
                            <li><a href="javascript:void(0)" class="small" data-value="3" tabIndex="-1"><input
                                    type="checkbox"/> Year 3</a></li>
                        </ul>
                    </div>

                    <button class="btn btn-info" type="button" id="sp-filterBtn">Apply Filter</button>
                    <button class="btn btn-danger clearBtn" type="button">Clear all filters</button>

                </div>
                <!-- /.box-header -->
                <div class="box-body">
                    <div style="width:90%;display:inline-block;padding:10px 0 0 5px;">
                        <canvas id="specialisation-bar"></canvas>
                    </div>
                </div>
            </div><!-- /.box -->
            </div><!-- /.margin 15 row -->
        <div class="col-md-5">
            <!-- USERS LIST -->
            <div class="box">
                <div class="box-header with-border">
                    <h3 class="box-title">Popular Freely Chosen Module</h3>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse"><i
                                class="fa fa-minus"></i>
                        </button>
                        <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i>
                        </button>
                    </div>
                </div>
                <!-- /.box-header -->
                <div class="box-body no-padding">
                    <div class="box box-widget widget-user-2"
                         style="display:inline-block;padding:30px 50px 30px 50px; ">
                        <!-- Add the bg color to the header using any of the bg-* classes -->
                        <div class="widget-user-header" style="background-color:#d3d3d3;box-shadow: 5px 5px 3px #888888;">
                            <h3 class="widget-user-username" style="margin-left:0px!important;">Popular Freely Chosen Modules</h3>
                        </div>
                        <div class="box-footer no-padding">
                            <ul class="nav nav-stacked">
                                <li><a href="#"><strong><u>Module</u></strong><span class="pull-right badge ">Students</span></a></li>
                                {% for fm in fmcount %}
                                    <li><a href="#">{{ fm.0 }}<span class="pull-right badge bg-blue">{{ fm.1 }}</span></a>
                                    </li>
                                {% endfor %}

                            </ul>
                        </div>
                    </div>

                </div>
            </div>
        </div>

<div class="row">
    <div class="col-md-6">
        <!-- USERS LIST -->
        <div class="box box-danger">
            <div class="box-header with-border">
                <h3 class="box-title">MBTI</h3>
                <div class="box-tools pull-right">
                    <span class="label label-danger">16 MBTIs</span>
                    <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                    </button>
                    <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i>
                    </button>
                </div>
            </div>
            <!-- /.box-header -->
            <div class="box-body no-padding">

                {% if mbtis.0 %}
                    <ul class="users-list clearfix">
                        {% for mbti in mbtis %}
                            <li>
                                <a class="users-list-name" href="#">{{ mbti.0 }}</a>
                                <span class="users-list-date">{{ mbti.1 }}</span>
                            </li>
                        {% endfor %}
                    </ul>
                {% endif %}
                <!-- /.users-list -->
            </div>
            <!-- /.box-body -->
            <div class="box-footer text-center">
                <a href="https://www.16personalities.com/personality-types" class="uppercase">Go to MBTI Page</a>
            </div>
            <!-- /.box-footer -->
        </div>
        <!--/.box -->
    </div>
    <!-- /.col -->

    <div class="row">
        <div class="col-md-6">
            <!-- USERS LIST -->
            <div class="box box-info">
                <div class="box-header with-border">
                    <h3 class="box-title">Jobs</h3>
                    <div class="box-tools pull-right">
                        <span class="label label-info">Tracking</span>
                        <button type="button" class="btn btn-box-tool" data-widget="collapse"><i
                                class="fa fa-minus"></i>
                        </button>
                        <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i>
                        </button>
                    </div>
                </div>
                <!-- /.box-header -->
                <div class="box-body no-padding">
                    <div class="box box-widget widget-user-2"
                         style="display:inline-block;padding:30px 50px 30px 50px; ">
                        <!-- Add the bg color to the header using any of the bg-* classes -->
                        <div class="widget-user-header bg-blue">
                            <h3 class="widget-user-username" style="margin-left:0px!important;">Popular Job Positions</h3>
                        </div>
                        <div class="box-footer no-padding">
                            <ul class="nav nav-stacked">
                                {% for job in popjobs %}
                                    <li><a href="#">{{ job.0 }}<span class="pull-right badge bg-blue">{{ job.1 }}</span></a>
                                    </li>
                                {% endfor %}

                            </ul>
                        </div>
                    </div>

                </div>
                <!-- /.box-body -->
                <div class="box-footer text-center">
                    <div class="col-md-4 col-sm-4 col-xs-6">
                        <div class="description-block border-right">
                            <h5 class="description-header">{{ totaljobs }}</h5>
                            <span class="description-text">Total No. of Jobs</span>
                        </div>
                        <!-- /.description-block -->
                    </div>
                    <div class="col-md-4 col-sm-4 col-xs-6">
                        <div class="description-block border-right">
                            <h5 class="description-header">{{ pubcount }}</h5>
                            <span class="description-text">Total No. Clicks from Public Sector Jobs</span>
                        </div>
                        <!-- /.description-block -->
                    </div>
                    <!-- /.col -->
                    <div class="col-md-4 col-sm-4 col-xs-6">
                        <div class="description-block">
                            <h5 class="description-header">{{ privatecount }}</h5>
                            <span class="description-text">Total No. Clicks from Private Sector Jobs</span>
                        </div>
                    </div>
                    <!-- /.box-footer -->
                </div>
                <!--/.box -->
            </div>


        </div>
        <!-- /.row -->

        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->


</div>
<!-- ./wrapper -->

<!-- FastClick -->
<script src="{% static 'AdminLTE-2.4.0-rc/bower_components/fastclick/lib/fastclick.js' %}"></script>
<!-- AdminLTE App -->
<script src="{% static 'AdminLTE-2.4.0-rc/dist/js/adminlte.min.js' %}"></script>
<!-- Sparkline -->
<script src="{% static 'js/jquery.sparkline.min.js' %}"></script>
<!-- jvectormap  -->
<script src="{% static 'AdminLTE-2.4.0-rc/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js' %}"></script>
<script src="{% static 'AdminLTE-2.4.0-rc/plugins/jvectormap/jquery-jvectormap-world-mill-en.js' %}"></script>
<!-- SlimScroll -->
<script src="{% static 'AdminLTE-2.4.0-rc/bower_components/jquery-slimscroll/jquery.slimscroll.min.js' %}"></script>
<!-- ChartJS -->
<script src="{% static 'AdminLTE-2.4.0-rc/bower_components/chart.js/Chart.js' %}"></script>
<!-- Morris -->
<script src="{% static 'AdminLTE-2.4.0-rc/bower_components/morris.js/morris.min.js' %}"></script>
<!-- Raphael -->
<script src="{% static 'AdminLTE-2.4.0-rc/bower_components/raphael/raphael.min.js' %}"></script>
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<script src="{% static 'AdminLTE-2.4.0-rc/dist/js/pages/dashboard2.js' %}"></script>
<!-- AdminLTE for demo purposes -->
{#<script src="{% static 'AdminLTE-2.4.0-rc/dist/js/demo.js' %}"></script>#}

<script src="{% static 'js/sampleChartJS-barchart.js' %}"></script>
</body>
</html>

{% load static %}
<script src="{% static 'js/ajaxpost.js' %}"></script>

<script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/r224/prettify.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.0/Chart.bundle.js"></script>
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/prettify/r224/prettify.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.0/Chart.min.js">

<script>
    $(function () {
        $(".dropdown-menu li a").click(function () {
            $(this).parents('.dropdown-menu').siblings('.field-btn').text($(this).text());
            $(this).parents('.dropdown-menu').siblings('.field-btn').val($(this).text());

        });

        $("#filterBtn").click(function () {
            var dataString = '&school=' + encodeURIComponent($('#schoolField').text()) + '&diploma=' + encodeURIComponent($('#diplomaField').text()) + '&year=' + encodeURIComponent($('#yearField').text());
            $.ajax({
                type: 'GET',
                url: '/applyfilter/',
                data: dataString,
                dataType: 'json',
                success: function (response) {
                    if ($('#diplomaField').text() == 'Diploma') {
                        $('#diplomaName').text('All Schools');
                    } else {
                        $('#diplomaName').text($('#diplomaField').text());
                    }
                    $('#diplomaNum').text(response.population);
                }
            });
        });

        $("#career-filterBtn").click(function () {
            var dataString = '&diploma=' + encodeURIComponent($('#donut-diplomaField').text());
            $.ajax({
                type: 'GET',
                url: '/applycareerfilter/',
                data: dataString,
                dataType: 'json',
                success: function (response) {
                    if (response['count'] != -1) {
                        newdiplomaSameAsInterestCount = response['count']
                        newnotSameCount = {{ population }} -newdiplomaSameAsInterestCount
                        donut = new Morris.Donut({
                            element: 'donut-chart',
                            resize: true,
                            colors: ["#3c8dbc", "#f56954"],
                            data: [
                                {label: "Diploma Align with Career Interest in %", value: newdiplomaSameAsInterestCount/{{population}}*100 },
                                {label: "Diploma Not Align with Interest in %", value: newnotSameCount/{{population}}*100 },
                            ],
                            hideHover: 'auto'
                        });
                        $('#nodonutmsg').css({"display": "none"});
                    } else {
                        $('#nodonutmsg').html('Select Filter to Produce Chart <span class="glyphicon glyphicon-exclamation-sign"></span>');
                        $("#nodonutmsg").css({"display": "block"});
                    }
                }
            });
        });

        $('.clearBtn').click(function (){
             $(this).closest(".col-md-12").find(".btn-default.field-btn").text('School');
             $(this).closest(".col-md-12").find(".btn-primary.field-btn").text('Diploma');
             $(this).closest(".col-md-12").find(".btn-success.field-btn").text('Year');
        });

        {#        for career interest popularity#}
        $('a[href="#mostPopCareer"]').click(function () {
            htmlAppend = '<h5 style="text-align:center"><strong>Most Popular Career Interest</strong></h5><br>' +
                '<div class="progress-group"><span class="progress-text"><u>Interest</u></span><span class="progress-number"><strong><u>Count</u></strong></span></div><br />';
            {% for interest in mostPopInterestCount %}
                {% for i in interest.1 %}
                    htmlAppend += '<div class="progress-group"><span class="progress-text">{{ i }}</span><span class="progress-number"><strong>{{ interest.0 }}</strong></span></div><br />';
                {% endfor %}
            {% endfor %}
            $("#popularityCareer").html(htmlAppend);
        });

        $('a[href="#leastPopCareer"]').click(function () {
            var htmlAppend = '<h5 style="text-align:center"><strong>Least Popular Career Interest</strong></h5><br>' + '<div class="progress-group"><span class="progress-text"><u>Interest</u></span><span class="progress-number"><strong><u>Count</u></span></div><br />';
            {% for interest in leastPopInterestCount %}
                {% for i in interest.1 %}
                    htmlAppend += '<div class="progress-group"><span class="progress-text">{{ i }}</span><span class="progress-number"><strong>{{ interest.0 }}</span></div><br />';
                {% endfor %}
            {% endfor %}
            $("#popularityCareer").html(htmlAppend);
        });

        $('a[href="#allInterestCareer"]').click(function () {
            var htmlAppend = '<div class="progress-group"><span class="progress-text"><u>Interest</u></span><span class="progress-number"><strong><u>Count</u></span></div><br />';
            {% for interestname,count in allInterestCount.items %}
                htmlAppend += '<div class="progress-group" ><span class="progress-text">{{interestname}}</span><span class="progress-number"><b>{{ count }}</b></span></div><br />';
            {% endfor %}
            console.log(htmlAppend);
            $("#popularityCareer").html(htmlAppend);
        });


        {#        for specialization popularity#}
        $('a[href="#mostPop"]').click(function () {
            var htmlAppend = '<h5 style="text-align:center"><strong>Most Popular Specialisations</strong></h5><br><div class="progress-group"><span class="progress-text"><u>Specialization</u></span><span class="progress-number"><strong><u>Count</u></span></div><br />';
            {% for arr in popularSpecialisation %}
                {% for sp in arr.1 %}
                    htmlAppend += '<div class="progress-group"><span class="progress-text">{{ sp }}</span><span class="progress-number"><strong>{{ arr.0 }}</span></div><br />';
                {% endfor %}
            {% endfor %}
            $("#popularitySpecialisation").html(htmlAppend);
        });

        $('a[href="#leastPop"]').click(function () {
            var htmlAppend = '<h5 style="text-align:center"><strong>Least Popular Specialisations</strong></h5><br><div class="progress-group"><span class="progress-text"><u>Specialization</u></span><span class="progress-number"><strong><u>Count</u></span></div><br />';
            {% for arr in leastPopSpecialisation %}
                {% for sp in arr.1 %}
                    htmlAppend += '<div class="progress-group"><span class="progress-text">{{ sp }}</span><span class="progress-number"><strong>{{ arr.0 }}</span></div><br />';
                {% endfor %}
            {% endfor %}
            $("#popularitySpecialisation").html(htmlAppend);
        });

        $('a[href="#allInterest"]').click(function () {
            var htmlAppend = '<div class="progress-group"><span class="progress-text"><u>Specialization</u></span><span class="progress-number"><strong><u>Count</u></span></div><br />';
            {% for sp in allSpecialisation %}
                htmlAppend += '<div class="progress-group" ><span class="progress-text">{{ sp.course_specialization__course_specialization }}</span><span class="progress-number"><b>{{ sp.user_count }}</b></span></div><br />';
            {% endfor %}
            $("#popularitySpecialisation").html(htmlAppend);
        });


    }); //end of function on load


    {## -- JS Align Student Interest --     #}
    var diplomaSameAsInterestCount = {{ diplomaSameAsInterestCount }}
    var notSameCount = 0
    if (diplomaSameAsInterestCount != -1) {
        notSameCount = {{ population }} -diplomaSameAsInterestCount
    } else { //if no diploma filter
        diplomaSameAsInterestCount = 0
        notSameCount =
        {{ population }}
    }


    window.onload = function () {

        var randomScalingFactor = function () {
            {#    max 20 min 0#}
            return Math.floor(Math.random() * (20 - 0 + 1)) + 0;
        };

//DONUT CHART
        var donut = new Morris.Donut({
            element: 'donut-chart',
            resize: true,
            colors: ["#3c8dbc", "#f56954"],
            data: [
                {label: "Diploma Align with Career Interest", value: diplomaSameAsInterestCount},
                {label: "Diploma Not Align with Interest", value: notSameCount},
            ],
            hideHover: 'auto'
        });

        {#    specilizaiton chart graph#}
        var splabels = []
        var splabelsid = []
        var spdata = []

//on load default
        {% for sp in allSpecialisation %}
            splabels.push('{{ sp.course_specialization__course_specialization }}');
            spdata.push('{{ sp.user_count }}');
        {% endfor %}

//change labels upon click
        $('#spdiploma-dropdown-menu').click(function () {
            splabels = []
            splabelsid = []
            var diploma = $('#sp-diplomaField').text();
            if (diploma != 'Diploma') {
                var dataString = '&diploma=' + encodeURIComponent(diploma);
                $.ajax({
                    type: 'GET',
                    url: '/getdiplomasp/',
                    data: dataString,
                    dataType: 'json',
                    success: function (response) {
                        if (response.sps) {
                            var array = $.parseJSON(response.sps);
                            for (label of array) {
                                splabels.push(label.course_specialization);
                            }
                            var idarray = $.parseJSON(response.spsid);
                            for (id of idarray) {
                                splabelsid.push(id.course_specialization_id);
                            }
                        }
                    }
                });
            }
        });

        var color = Chart.helpers.color;

        var yearoptions = [];
        $('#sp-dropdown-menu a').on('click', function (event) {

            var $target = $(event.currentTarget),
                val = $target.attr('data-value'),
                $inp = $target.find('input'),
                idx;
            if (( idx = yearoptions.indexOf(val) ) > -1) {
                yearoptions.splice(idx, 1);
                setTimeout(function () {
                    $inp.prop('checked', false)
                }, 0);

            } else {
                yearoptions.push(val);
                setTimeout(function () {
                    $inp.prop('checked', true)
                }, 0);

            }
            var text = $inp.is(':checked')? "Year": "Checked"
            console.log(text)
            $('#sp-dropdown-menu a').closest('.btn-group-success').find('.field-btn').text(text);
        });
        console.log('yearoptions', yearoptions)
        $('#sp-filterBtn').on('click', function () {
            barChartData.labels = []
            barChartData.datasets = []
            $.ajax({
                type: 'GET',
                url: "/applyspfilter/",
                data: {"yearoptions[]": yearoptions, 'splabels[]': splabels, 'splabelsid[]': splabelsid},
                dataType: 'json',
                success: function (response) {
                    if (response.result) {
                        result = response.result;
                        console.log(result)
                        var newLabels = [];
                        if (yearoptions.indexOf('1') != -1) {
                            var data = [];
                            ds = result['1'];
                            for (pair of ds) {
                                barChartData.labels.push(pair[0])
                                data.push(pair[1])
                            }
                            var newDataset = {
                                label: 'Year 1',
                                backgroundColor: color(window.chartColors.red).alpha(0.5).rgbString(),
                                borderColor: window.chartColors.red,
                                borderWidth: 1,
                                data: data
                            };
                            barChartData.datasets.push(newDataset);
                        }
                        if (yearoptions.indexOf('2') != -1) {
                            var data = [];
                            ds = result['2'];
                            for (pair of ds) {
                                data.push(pair[1])
                            }
                            var newDataset2 = {
                                label: 'Year 2',
                                backgroundColor: color(window.chartColors.blue).alpha(0.5).rgbString(),
                                borderColor: window.chartColors.blue,
                                borderWidth: 1,
                                data: data
                            };
                            barChartData.datasets.push(newDataset2);
                        }
                        if (yearoptions.indexOf('3') != -1) {
                            var data = [];
                            ds = result['3'];
                            for (pair of ds) {
                                data.push(pair[1])
                            }
                            var newDataset3 = {
                                label: 'Year 3',
                                backgroundColor: color(window.chartColors.yellow).alpha(0.5).rgbString(),
                                borderColor: window.chartColors.yellow,
                                borderWidth: 1,
                                data: data
                            };
                            barChartData.datasets.push(newDataset3);
                        }
                        window.myBar.update();
                    }
                }
            });
        });

        var barChartData = {
            labels: splabels,
            datasets: [{
                label: 'Total',
                backgroundColor: color(window.chartColors.purple).alpha(0.5).rgbString(),
                borderColor: window.chartColors.purple,
                borderWidth: 1,
                data: spdata
            }],
            ticks: {
                autoSkip: false,
                beginAtZero: true
            }
        };


        var ctx = document.getElementById("specialisation-bar").getContext("2d");
        window.myBar = new Chart(ctx, {
            type: 'bar',
            data: barChartData,
            options: {
                responsive: true,
                legend: {
                    position: 'right',
                },
                title: {
                    display: true,
                    text: 'Num of Students Based on Specialisation'
                }, scaleBeginAtZero: true,
                scales: {
                    xAxes: [{
                        ticks: {
                            min: 0
                        }
                    }],
                    yAxes: [{
                        min: 0,
                        suggestedMax: 5
                    }]
                }
            },

        });

        var colorNames = Object.keys(window.chartColors);


    };
</script>
